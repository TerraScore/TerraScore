{
  "info": {
    "name": "TerraScore API (Sprints 1-6)",
    "description": "Full API collection for TerraScore platform. Covers auth, parcels, agents, jobs, surveys, alerts, and reports.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      { "key": "token", "value": "{{auth_token}}", "type": "string" }
    ]
  },
  "variable": [
    { "key": "base_url", "value": "http://localhost:8000" }
  ],
  "item": [
    {
      "name": "Health",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": { "raw": "{{base_url}}/health", "host": ["{{base_url}}"], "path": ["health"] },
            "auth": { "type": "noauth" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": ["pm.test('Status 200', () => pm.response.to.have.status(200));"]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Auth — Landowner",
      "item": [
        {
          "name": "Register Landowner",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"phone\": \"{{phone}}\",\n  \"full_name\": \"Test Landowner\",\n  \"role\": \"landowner\"\n}"
            },
            "url": { "raw": "{{base_url}}/v1/auth/register", "host": ["{{base_url}}"], "path": ["v1", "auth", "register"] },
            "auth": { "type": "noauth" }
          }
        },
        {
          "name": "Login (Request OTP)",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"phone\": \"{{phone}}\"\n}"
            },
            "url": { "raw": "{{base_url}}/v1/auth/login", "host": ["{{base_url}}"], "path": ["v1", "auth", "login"] },
            "auth": { "type": "noauth" }
          }
        },
        {
          "name": "Verify OTP",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"phone\": \"{{phone}}\",\n  \"otp\": \"123456\"\n}"
            },
            "url": { "raw": "{{base_url}}/v1/auth/verify-otp", "host": ["{{base_url}}"], "path": ["v1", "auth", "verify-otp"] },
            "auth": { "type": "noauth" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  var json = pm.response.json();",
                  "  if (json.data && json.data.access_token) {",
                  "    pm.environment.set('auth_token', json.data.access_token);",
                  "    pm.environment.set('refresh_token', json.data.refresh_token);",
                  "  }",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Refresh Token",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refresh_token\": \"{{refresh_token}}\"\n}"
            },
            "url": { "raw": "{{base_url}}/v1/auth/refresh", "host": ["{{base_url}}"], "path": ["v1", "auth", "refresh"] },
            "auth": { "type": "noauth" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  var json = pm.response.json();",
                  "  if (json.data && json.data.access_token) {",
                  "    pm.environment.set('auth_token', json.data.access_token);",
                  "    pm.environment.set('refresh_token', json.data.refresh_token);",
                  "  }",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Parcels",
      "item": [
        {
          "name": "Create Parcel",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"label\": \"Test Parcel\",\n  \"district\": \"Bangalore Urban\",\n  \"state\": \"Karnataka\",\n  \"state_code\": \"KA\",\n  \"boundary\": \"{\\\"type\\\":\\\"Polygon\\\",\\\"coordinates\\\":[[[77.5945,12.9716],[77.5955,12.9716],[77.5955,12.9726],[77.5945,12.9726],[77.5945,12.9716]]]}\"\n}"
            },
            "url": { "raw": "{{base_url}}/v1/parcels", "host": ["{{base_url}}"], "path": ["v1", "parcels"] }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "  var json = pm.response.json();",
                  "  if (json.data && json.data.id) {",
                  "    pm.environment.set('parcel_id', json.data.id);",
                  "  }",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "List Parcels",
          "request": {
            "method": "GET",
            "url": { "raw": "{{base_url}}/v1/parcels?page=1&per_page=20", "host": ["{{base_url}}"], "path": ["v1", "parcels"], "query": [{ "key": "page", "value": "1" }, { "key": "per_page", "value": "20" }] }
          }
        },
        {
          "name": "Get Parcel Detail",
          "request": {
            "method": "GET",
            "url": { "raw": "{{base_url}}/v1/parcels/{{parcel_id}}", "host": ["{{base_url}}"], "path": ["v1", "parcels", "{{parcel_id}}"] }
          }
        },
        {
          "name": "Update Boundary",
          "request": {
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"boundary\": \"{\\\"type\\\":\\\"Polygon\\\",\\\"coordinates\\\":[[[77.5945,12.9716],[77.5960,12.9716],[77.5960,12.9730],[77.5945,12.9730],[77.5945,12.9716]]]}\"\n}"
            },
            "url": { "raw": "{{base_url}}/v1/parcels/{{parcel_id}}/boundary", "host": ["{{base_url}}"], "path": ["v1", "parcels", "{{parcel_id}}", "boundary"] }
          }
        },
        {
          "name": "Delete Parcel",
          "request": {
            "method": "DELETE",
            "url": { "raw": "{{base_url}}/v1/parcels/{{parcel_id}}", "host": ["{{base_url}}"], "path": ["v1", "parcels", "{{parcel_id}}"] }
          }
        }
      ]
    },
    {
      "name": "Auth — Agent",
      "item": [
        {
          "name": "Register Agent",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"full_name\": \"Test Agent\",\n  \"phone\": \"{{agent_phone}}\",\n  \"state_code\": \"KA\",\n  \"district_code\": \"BLR\"\n}"
            },
            "url": { "raw": "{{base_url}}/v1/agents/register", "host": ["{{base_url}}"], "path": ["v1", "agents", "register"] },
            "auth": { "type": "noauth" }
          }
        },
        {
          "name": "Agent Login + OTP",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"phone\": \"{{agent_phone}}\",\n  \"otp\": \"123456\"\n}"
            },
            "url": { "raw": "{{base_url}}/v1/auth/verify-otp", "host": ["{{base_url}}"], "path": ["v1", "auth", "verify-otp"] },
            "auth": { "type": "noauth" }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  var json = pm.response.json();",
                  "  if (json.data && json.data.access_token) {",
                  "    pm.environment.set('agent_token', json.data.access_token);",
                  "  }",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Agents",
      "auth": {
        "type": "bearer",
        "bearer": [{ "key": "token", "value": "{{agent_token}}", "type": "string" }]
      },
      "item": [
        {
          "name": "Get Agent Profile (me)",
          "request": {
            "method": "GET",
            "url": { "raw": "{{base_url}}/v1/agents/me", "host": ["{{base_url}}"], "path": ["v1", "agents", "me"] }
          }
        },
        {
          "name": "Update Agent Profile",
          "request": {
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"vehicle_type\": \"motorcycle\",\n  \"preferred_radius_km\": 15\n}"
            },
            "url": { "raw": "{{base_url}}/v1/agents/me/profile", "host": ["{{base_url}}"], "path": ["v1", "agents", "me", "profile"] }
          }
        },
        {
          "name": "Update Agent Location",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"lat\": 12.9716,\n  \"lng\": 77.5946,\n  \"accuracy\": 10\n}"
            },
            "url": { "raw": "{{base_url}}/v1/agents/me/location", "host": ["{{base_url}}"], "path": ["v1", "agents", "me", "location"] }
          }
        },
        {
          "name": "Update FCM Token",
          "request": {
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fcm_token\": \"test-fcm-token-12345\"\n}"
            },
            "url": { "raw": "{{base_url}}/v1/agents/me/fcm-token", "host": ["{{base_url}}"], "path": ["v1", "agents", "me", "fcm-token"] }
          }
        },
        {
          "name": "Update Availability",
          "request": {
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"available_days\": [\"mon\", \"tue\", \"wed\", \"thu\", \"fri\"],\n  \"available_start\": \"09:00\",\n  \"available_end\": \"18:00\",\n  \"is_online\": true\n}"
            },
            "url": { "raw": "{{base_url}}/v1/agents/me/availability", "host": ["{{base_url}}"], "path": ["v1", "agents", "me", "availability"] }
          }
        }
      ]
    },
    {
      "name": "Jobs",
      "auth": {
        "type": "bearer",
        "bearer": [{ "key": "token", "value": "{{agent_token}}", "type": "string" }]
      },
      "item": [
        {
          "name": "Get Job Detail",
          "request": {
            "method": "GET",
            "url": { "raw": "{{base_url}}/v1/jobs/{{job_id}}", "host": ["{{base_url}}"], "path": ["v1", "jobs", "{{job_id}}"] }
          }
        },
        {
          "name": "List Agent Jobs",
          "request": {
            "method": "GET",
            "url": { "raw": "{{base_url}}/v1/agents/me/jobs?page=1&per_page=10", "host": ["{{base_url}}"], "path": ["v1", "agents", "me", "jobs"], "query": [{ "key": "page", "value": "1" }, { "key": "per_page", "value": "10" }] }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  var json = pm.response.json();",
                  "  if (json.data && json.data.length > 0) {",
                  "    pm.environment.set('job_id', json.data[0].id);",
                  "  }",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "List Agent Offers",
          "request": {
            "method": "GET",
            "url": { "raw": "{{base_url}}/v1/agents/me/offers", "host": ["{{base_url}}"], "path": ["v1", "agents", "me", "offers"] }
          }
        },
        {
          "name": "Accept Offer",
          "request": {
            "method": "POST",
            "url": { "raw": "{{base_url}}/v1/jobs/{{job_id}}/accept", "host": ["{{base_url}}"], "path": ["v1", "jobs", "{{job_id}}", "accept"] }
          }
        },
        {
          "name": "Decline Offer",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"too far\"\n}"
            },
            "url": { "raw": "{{base_url}}/v1/jobs/{{job_id}}/decline", "host": ["{{base_url}}"], "path": ["v1", "jobs", "{{job_id}}", "decline"] }
          }
        },
        {
          "name": "Arrive at Parcel",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"lat\": 12.9716,\n  \"lng\": 77.5946\n}"
            },
            "url": { "raw": "{{base_url}}/v1/jobs/{{job_id}}/arrive", "host": ["{{base_url}}"], "path": ["v1", "jobs", "{{job_id}}", "arrive"] }
          }
        },
        {
          "name": "Get Checklist Template",
          "request": {
            "method": "GET",
            "url": { "raw": "{{base_url}}/v1/jobs/{{job_id}}/template", "host": ["{{base_url}}"], "path": ["v1", "jobs", "{{job_id}}", "template"] }
          }
        },
        {
          "name": "Get Presigned Upload URL",
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{base_url}}/v1/jobs/{{job_id}}/media/presigned?content_type=image/jpeg&step_id=step_1",
              "host": ["{{base_url}}"],
              "path": ["v1", "jobs", "{{job_id}}", "media", "presigned"],
              "query": [{ "key": "content_type", "value": "image/jpeg" }, { "key": "step_id", "value": "step_1" }]
            }
          }
        },
        {
          "name": "Record Media Metadata",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"s3_key\": \"media/{{job_id}}/step_1/test.jpg\",\n  \"step_id\": \"step_1\",\n  \"media_type\": \"image/jpeg\",\n  \"lat\": 12.9716,\n  \"lng\": 77.5946,\n  \"sha256\": \"abc123def456\",\n  \"file_size\": 102400,\n  \"captured_at\": \"2026-01-15T10:30:00Z\"\n}"
            },
            "url": { "raw": "{{base_url}}/v1/jobs/{{job_id}}/media", "host": ["{{base_url}}"], "path": ["v1", "jobs", "{{job_id}}", "media"] }
          }
        },
        {
          "name": "Submit Survey",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"responses\": {\"step_1\": {\"answer\": \"yes\", \"notes\": \"All clear\"}, \"step_2\": {\"answer\": \"no\", \"notes\": \"Minor issue observed\"}},\n  \"gps_trail_geojson\": \"{\\\"type\\\":\\\"LineString\\\",\\\"coordinates\\\":[[77.5945,12.9716],[77.5950,12.9720],[77.5955,12.9725]]}\",\n  \"started_at\": \"2026-01-15T10:00:00Z\",\n  \"duration_minutes\": 30\n}"
            },
            "url": { "raw": "{{base_url}}/v1/jobs/{{job_id}}/survey", "host": ["{{base_url}}"], "path": ["v1", "jobs", "{{job_id}}", "survey"] }
          }
        }
      ]
    },
    {
      "name": "Alerts",
      "item": [
        {
          "name": "List Alerts",
          "request": {
            "method": "GET",
            "url": { "raw": "{{base_url}}/v1/alerts?page=1&per_page=20", "host": ["{{base_url}}"], "path": ["v1", "alerts"], "query": [{ "key": "page", "value": "1" }, { "key": "per_page", "value": "20" }] }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  var json = pm.response.json();",
                  "  if (json.data && json.data.length > 0) {",
                  "    pm.environment.set('alert_id', json.data[0].id);",
                  "  }",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Get Unread Count",
          "request": {
            "method": "GET",
            "url": { "raw": "{{base_url}}/v1/alerts/unread/count", "host": ["{{base_url}}"], "path": ["v1", "alerts", "unread", "count"] }
          }
        },
        {
          "name": "Mark Alert Read",
          "request": {
            "method": "PUT",
            "url": { "raw": "{{base_url}}/v1/alerts/{{alert_id}}/read", "host": ["{{base_url}}"], "path": ["v1", "alerts", "{{alert_id}}", "read"] }
          }
        },
        {
          "name": "Mark All Read",
          "request": {
            "method": "PUT",
            "url": { "raw": "{{base_url}}/v1/alerts/read-all", "host": ["{{base_url}}"], "path": ["v1", "alerts", "read-all"] }
          }
        }
      ]
    },
    {
      "name": "Reports",
      "item": [
        {
          "name": "List Reports by Parcel",
          "request": {
            "method": "GET",
            "url": { "raw": "{{base_url}}/v1/parcels/{{parcel_id}}/reports?page=1&per_page=10", "host": ["{{base_url}}"], "path": ["v1", "parcels", "{{parcel_id}}", "reports"], "query": [{ "key": "page", "value": "1" }, { "key": "per_page", "value": "10" }] }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "  var json = pm.response.json();",
                  "  if (json.data && json.data.length > 0) {",
                  "    pm.environment.set('report_id', json.data[0].id);",
                  "  }",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "Download Report",
          "request": {
            "method": "GET",
            "url": { "raw": "{{base_url}}/v1/reports/{{report_id}}/download", "host": ["{{base_url}}"], "path": ["v1", "reports", "{{report_id}}", "download"] }
          }
        }
      ]
    }
  ]
}
